Рассмотрим, какие репозитории с Kathara предлагает нам сайт https://github.com. Для этого на сайте в окне поиска введем ключевое слово - Kathara.

Первым мы видим официальный акаунт на github от создателей Kathara - https://github.com/KatharaFramework. На нем можно найти репозитории с описанием проекта, кодом эмулятора, инструкциями по установке на различные операционные системы, примерами лабораторных работ, docker-файлами и скриптами для установки Kathara внутри docker и так далее.

Теперь речь пойдет о неофициальных проектах, связанных с данным средством моделирования. Например, https://github.com/ErCrozzUni/kathara_ebpf - диссертационное исследование от Леонарда Кроццоли и Лоренцо Бенци, цель которого - поэкспериментировать с передовыми методами отслеживания вредоносных потоков в среде эмуляции сети Kathara с помощью программ eBPF. Ebfp (extended Berkeley Packet Filter) - современная технология ядра Linux, которая предоставляет возможность запускать в пространстве ядра программы, заключенные в песочницу. Данный фильтр позволяет расширить возможности ядра без необходимости загружать в него дополнительные модули и запускать компиляцию заново. В области кибербезопасности мониторинг потоков сетевого трафика крайне важен для обнаружения аномальной и потенциально опасной активности, ведь пресечение кибератаки может значительно снизить её воздействие на систему.

Еще один репозиторий, на который мы обратим внимание, - https://github.com/vitome/pnd-labs. Здесь можно найти пять лабораторных работ по Kathara для курса "Practical Network Defense" в Римском университете Sapienza. Данный проект может быть использован для освоения основных методов эмуляции сетей, так как он представляет собой сборник как работающих топологий, так и задач для самостоятельного изучения.

На сайте github.com также представлен репозиторий https://github.com/tcaiazzi/kathara-trex-labs, содержащий готовые Kathara-сценарии для интеграции с TRex (Cisco TRex) — генератора трафика с открытым исходным кодом. TRex использует технологию DPDK (Data Plane Development Kit) - проект Linux Foundation, состоящий из библиотек для ускорения обработки сетевых пакетов на разных архитектурах центрального процессора. В связке с Kathara это позволяет воспроизводить высоконагруженные DDoS-сценарии и исследовать поведение сетевых сервисов и защитных механизмов при реальной нагрузке.

Репозиторий [](https://github.com/Martolins/Hierarchical-SDN-using-Kathara) -- лабораторный проект, моделирующий иерархическую SDN-архитектуру с использованием эмулятора Kathara. Автор создал виртуальную сеть, где управление трафиком происходит централизованно с помощью нескольких контроллеров, распределенных по уровням. На сценариях лабораторного стенда можно продемонстрировать взаимодействие контроллеров в сети : 

- Локальный контроллер управляет трафиком внутри своего домена.

- Корневой контроллер координирует взаимодействие между разными доменами.

- Если один контроллер падает, его часть сети продолжает работать под управлением другого.

Репозиторий [](https://github.com/buonhobo/Katharsis) полноценный фреймворк для управления сетевыми экспериментами, реализующий принцип "Infrastructure as Code". Он предоставляет сетевой интерфейс для использования Kathara, что упрощает описание сложных сетевых топологий, позволяет автоматизировать их развертывание и тестирование.

Остановимся подробнее на репозитории kathara_ebpf. Архив проекта представляет собой лабораторную установку, реализующую анализ сетевого трафика с помощью eBPF. Проект состоит из трех каталогов - docs, ebpf и labs. В каталоге docs присутствуют файлы с командами для eBPF.  В каталоге ebpf хранятся файлы, необходимые для создания docker-образа, который будет использоваться внутри узлов kathara (pc1, pc2, r1, r2). При сборке образа создается минимальная linux-среда с утилитами clang, llvm, bpftool, make и библиотекой libbpf, которая позволяет создавать и развертывать программы eBPF в ядре linux. В каталоге labs хранятся лабораторные работы для Kathara.  Каждая работа оформлена в своей папке - lab1, lab2. 

Рассмотрим lab1 - исследование eBPF-фильтрации UDP-трафика. Внутри мы видим общий файл, описывающий связи в топологии (lab.conf), скрипты инициализации узлов (pc1.startup, pc2.startup, pc3.startup, r1.startup, r2.startup), общий каталог shared и два каталога под узлы pc1 и pc2. В каталоге pc1 хранятся исходный код eBPF-программы (xdp_tree.c), правила компиляции программы (Makefile), скомпилированный объектный файл (xdp_tree.o), скрипт для расшифровки содержимого карты BPF (decode_flow_map.py). В каталоге pc2 хранится Python-скрипт для отправки UDP-пакетов (udp_sender.py).

Запустим топологию - sudo kathara lstart. Посмотрим список запущенных узлов - sudo kathara list.

![[Screenshot 2025-10-05 at 23.25.29.png]]

После запуска топологии был выполнен вход на терминал pc1 командой: sudo kathara connect pc1. В рабочем каталоге /home выполним сборку исходного файла xdp_tree.c командой make.
![[Screenshot 2025-10-05 at 22.58.51.png]]
Создается объектный файл xdp_tree.o, который затем загружается в сетевой интерфейс eth0 в виде XDP-фильтра: ip link set dev eth0 xdpgeneric obj xdp_tree.o sec xdp. Для проверки загрузки программы воспользуемся утилитой bpftool, а именно командой bpftool prog show, которая позволит нам посмотреть подробную информацию о загруженных в ядро eBPF-программах.

![[Screenshot 2025-10-05 at 23.07.34.png]]

Также воспользуемся командой bpftool map show, которая показывает список всех доступных BPF-карт (maps) в системе. Заметим, что в запись xdp name count_udp_flows подтверждает, что наша программа была успешно загружена в ядро. Увидим, что у нашей программы есть map_ids 45, это означает, что создана и подключена карта flow_map, где будут храниться результаты анализа пакетов.

![[Screenshot 2025-10-05 at 23.44.08.png]]

Напомним, что цель нашего эксперимента - сгенерировать UDP-нагрузку с узла pc2 и пропустить ее через маршрутизаторы к узлу pc2, где загружена XDP-программа. Подключаемся к узлу pc2.  Генерируем нагрузку с помощью запуска Python-скрипта udp_sender.py.

![[Screenshot 2025-10-05 at 23.49.40.png]]

В окне pc1 наблюдаем карту. Видим в значении key поля saddr и daddr адреса источника и получателя, записанные в формате 32-битных беззнаковых целых (uint32) в little-endian. Преобразуя в привычную нам запись формата IPv4 получаем - 117506504 -> 200.1.1.7 и 84806595 -> > 195.11.14.5. Также видим поля sport и dport - это 16-битные целочисленные номера портов отправителя (45845) и получателя (3879). В значении value расписаны packet_count — количество пакетов потока (732), byte_count — суммарный объём в байтах для этого потока, first_ts — временная метка первого пакета в наносекундах, last_ts - временная метка последнего пакета в наносекундах, avg_pps (packets per second) - средняя скорость в пакетах в секунду (4247).

![[Screenshot 2025-10-05 at 23.09.59.png]]
Проведённый эксперимент продемонстрировал работу XDP-программы count_udp_flows, выполняющей анализ UDP-потоков в реальном времени. Программа успешно отлавливает все проходящие пакеты, определяет IP-адреса и порты взаимодействующих узлов, подсчитывает количество и объём пакетов, а также вычисляет интенсивность трафика.